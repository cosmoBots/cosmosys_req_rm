(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return p});var a=n(5),r=n(6),o=n(25),c=n(24),l=n(26),s=n(0),i=n.n(s),u=n(72),d=n(71),h=n.n(d),f=5;function g(e){return i.a.createElement("button",{disabled:e.disabled,onClick:e.disabled?null:e.onClick},e.label)}function m(e){var t=["btn","btn-outline-success",e.type];return i.a.createElement("button",{className:t,style:{verticalAlign:"middle"},disabled:e.disabled,onClick:e.disabled?null:e.onClick},e.label)}function b(e){return e.reduce(function(e,t){var n={id:t.id};return t.children&&t.children.length&&(n.children=b(t.children)),e.push(n),e},[])}var p=function(t){function n(){var t,r;Object(a.a)(this,n);for(var l=arguments.length,s=new Array(l),d=0;d<l;d++)s[d]=arguments[d];return(r=Object(o.a)(this,(t=Object(c.a)(n)).call.apply(t,[this].concat(s)))).state={searchString:"",searchFocusIndex:0,searchFoundCount:null,treeData:null,treeHasChanges:!1},r.componentDidMount=function(){r.retrieveTree()},r.retrieveTree=function(){h.a.get(window.location.pathname.concat(".json"),{crossdomain:!0}).then(function(e){console.log("reqtreedata.json",e.data),r.setState({treeData:e.data,returnUrl:e.data[0].return_url})})},r.refreshTree=function(){r.setState({treeData:null,actionWindow:null,actionNode:null},r.retrieveTree)},r.onActionButtonClick=function(e,t){var n=function(e){return window.open(e,"RedmineAction","height=250,width=250")}(t);r.setState({actionWindow:n,actionNode:e});var a=setInterval(function(){n.closed&&(clearInterval(a),r.refreshTree())},500)},r.doCommitJSON=function(){console.log("hola commit!",r.state.returnUrl,b(r.state.treeData)),h.a.post(r.state.returnUrl,{structure:b(r.state.treeData)}).then(function(e){console.log(e),console.log(e.data),r.refreshTree()})},r.handleTreeOnChange=function(e){r.setState({treeData:e,treeHasChanges:!0}),console.log(e)},r.handleSearchOnChange=function(e){r.setState({searchString:e.target.value})},r.selectPrevMatch=function(){var e=r.state,t=e.searchFocusIndex,n=e.searchFoundCount;r.setState({searchFocusIndex:null!==t?(n+t-1)%n:n-1})},r.selectNextMatch=function(){var e=r.state,t=e.searchFocusIndex,n=e.searchFoundCount;r.setState({searchFocusIndex:null!==t?(t+1)%n:0})},r.toggleNodeExpansion=function(e){r.setState(function(t){return{treeData:Object(u.b)({treeData:t.treeData,expanded:e})}})},r.renderTree=function(){if(console.log("renderTree()",!!r.state.treeData),r.state.treeData){var t=r.state,n=t.treeData,a=t.treeHasChanges,o=t.searchString,c=t.searchFocusIndex;return i.a.createElement(u.a,{treeData:n,onChange:r.handleTreeOnChange,onMoveNode:function(t){var n=t.node,a=t.treeIndex,r=t.path;return e.console.debug("node:",n,"treeIndex:",a,"path:",r)},maxDepth:f,searchQuery:o,searchFocusOffset:c,canDrag:function(e){return!e.node.noDragging},canDrop:function(e){var t=e.nextParent;return!t||!t.noChildren},searchFinishCallback:function(e){return r.setState({searchFoundCount:e.length,searchFocusIndex:e.length>0?c%e.length:0})},isVirtualized:!0,generateNodeProps:function(e){return{buttons:[i.a.createElement(m,{type:"edit",disabled:a,label:"Edit",onClick:function(){r.onActionButtonClick(e.node,e.node.issue_edit_url)}}),i.a.createElement(m,{type:"new",disabled:a,label:"New",onClick:function(){r.onActionButtonClick(e.node,e.node.issue_new_url)}}),i.a.createElement(m,{type:"show",disabled:a,label:"Show",onClick:function(){r.onActionButtonClick(e.node,e.node.issue_show_url)}})]}}})}return i.a.createElement("span",null,"Loading tree...")},r.renderVeil=function(e){return r.state.actionWindow,e},r}return Object(l.a)(n,t),Object(r.a)(n,[{key:"render",value:function(){console.log("render()");var e=this.state,t=e.searchFocusIndex,n=e.searchFoundCount;e.actionWindow;return this.renderVeil(i.a.createElement("div",{className:"wrapper"},i.a.createElement("div",{className:"bar-wrapper"},i.a.createElement("button",{onClick:this.toggleNodeExpansion.bind(this,!0)},"Expand all"),i.a.createElement("button",{className:"collapse",onClick:this.toggleNodeExpansion.bind(this,!1)},"Collapse all"),i.a.createElement("label",null,"Search: "),i.a.createElement("input",{onChange:this.handleSearchOnChange}),i.a.createElement("button",{className:"previous",onClick:this.selectPrevMatch},"Previous"),i.a.createElement("button",{className:"next",onClick:this.selectNextMatch},"Next"),i.a.createElement("label",null,t," / ",n),i.a.createElement(g,{label:"commit",disabled:!this.state.treeHasChanges,onClick:this.doCommitJSON})),i.a.createElement("div",{className:"tree-wrapper"},this.renderTree())))}}]),n}(i.a.Component)}).call(this,n(22))},108:function(e,t,n){e.exports=n(109)},109:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(16),c=n.n(o),l=n(101),s=(n(204),n(205),new URLSearchParams(window.location.search).get("node_id")),i=document.getElementById("root");c.a.render(r.a.createElement(l.a,{nodeId:s}),i)},204:function(e,t,n){}},[[108,1,2]]]);
//# sourceMappingURL=main.6b98a6c0.chunk.js.map